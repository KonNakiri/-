<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>文化祭予算管理</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f4f4f4; }
    h1 { font-size: 1.5rem; }
    label { display: block; margin-top: 1rem; }
    input, button { width: 100%; padding: 0.5rem; margin-top: 0.5rem; }
    .entry { background: #fff; padding: 1rem; margin-top: 1rem; border-radius: 8px; }
    .complete { background: #d0ffd0; }
    .budget { margin-top: 2rem; font-size: 1.2rem; background: #fff; padding: 1rem; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>予算申告フォーム</h1>
  <form id="entry-form">
    <label>
      代表者名:
      <input type="text" id="name" required />
    </label>
    <label>
      使用予定金額（円）:
      <input type="number" id="planned" required />
    </label>
    <button type="submit">申告する</button>
  </form>

  <div class="budget" id="budget-summary"></div>

  <h2>申告一覧</h2>
  <div id="entries"></div>

  <script>
    const form = document.getElementById("entry-form");
    const entries = document.getElementById("entries");
    const budgetSummary = document.getElementById("budget-summary");
    const TOTAL_BUDGET = 61500;
    const requests = [];

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const planned = parseInt(document.getElementById("planned").value);
      const id = Date.now();
      const entry = { id, name, planned, actual: null, complete: false };
      requests.push(entry);
      render();
      form.reset();
    });

    function calculateUsed() {
      return requests.reduce((sum, r) => {
        return sum + (r.complete ? r.actual : r.planned);
      }, 0);
    }

    function render() {
      entries.innerHTML = "";
      requests.forEach((r) => {
        const div = document.createElement("div");
        div.className = "entry" + (r.complete ? " complete" : "");
        div.innerHTML = `
          <strong>${r.name}</strong><br>
          予定: ${r.planned} 円<br>
          実績: ${r.actual != null ? r.actual + " 円" : "未入力"}<br>
          ${!r.complete ? `<label>使用金額:
            <input type='number' id='actual-${r.id}' /><button onclick='submitActual(${r.id})'>確定</button></label>` : "完了☑️"}
        `;
        entries.appendChild(div);
      });
      const used = calculateUsed();
      const remaining = TOTAL_BUDGET - used;
      budgetSummary.innerHTML = `
        💰 総予算: ${TOTAL_BUDGET} 円<br>
        🧾 使用中金額: ${used} 円<br>
        💸 残り予算: ${remaining} 円
      `;
    }

    window.submitActual = (id) => {
      const target = requests.find(r => r.id === id);
      const input = document.getElementById(`actual-${id}`);
      const actual = parseInt(input.value);
      if (actual > target.planned) {
        alert("予定金額を超えています。登録できません。");
        return;
      }
      target.actual = actual;
      target.complete = true;
      render();
    };
  </script>
</body>
</html>
