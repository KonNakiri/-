<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡åŒ–ç¥­äºˆç®—ç®¡ç†</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f4f4f4; }
    h1 { font-size: 1.5rem; }
    label { display: block; margin-top: 1rem; }
    input, button { width: 100%; padding: 0.5rem; margin-top: 0.5rem; }
    .entry { background: #fff; padding: 1rem; margin-top: 1rem; border-radius: 8px; }
    .complete { background: #d0ffd0; }
    .budget { margin-top: 2rem; font-size: 1.2rem; background: #fff; padding: 1rem; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>äºˆç®—ç”³å‘Šãƒ•ã‚©ãƒ¼ãƒ </h1>
  <form id="entry-form">
    <label>
      ä»£è¡¨è€…å:
      <input type="text" id="name" required />
    </label>
    <label>
      ä½¿ç”¨äºˆå®šé‡‘é¡ï¼ˆå††ï¼‰:
      <input type="number" id="planned" required />
    </label>
    <button type="submit">ç”³å‘Šã™ã‚‹</button>
  </form>

  <div class="budget" id="budget-summary"></div>

  <h2>ç”³å‘Šä¸€è¦§</h2>
  <div id="entries"></div>

  <script>
    const form = document.getElementById("entry-form");
    const entries = document.getElementById("entries");
    const budgetSummary = document.getElementById("budget-summary");
    const TOTAL_BUDGET = 61500;
    const requests = [];

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const planned = parseInt(document.getElementById("planned").value);
      const id = Date.now();
      const entry = { id, name, planned, actual: null, complete: false };
      requests.push(entry);
      render();
      form.reset();
    });

    function calculateUsed() {
      return requests.reduce((sum, r) => {
        return sum + (r.complete ? r.actual : r.planned);
      }, 0);
    }

    function render() {
      entries.innerHTML = "";
      requests.forEach((r) => {
        const div = document.createElement("div");
        div.className = "entry" + (r.complete ? " complete" : "");
        div.innerHTML = `
          <strong>${r.name}</strong><br>
          äºˆå®š: ${r.planned} å††<br>
          å®Ÿç¸¾: ${r.actual != null ? r.actual + " å††" : "æœªå…¥åŠ›"}<br>
          ${!r.complete ? `<label>ä½¿ç”¨é‡‘é¡:
            <input type='number' id='actual-${r.id}' /><button onclick='submitActual(${r.id})'>ç¢ºå®š</button></label>` : "å®Œäº†â˜‘ï¸"}
        `;
        entries.appendChild(div);
      });
      const used = calculateUsed();
      const remaining = TOTAL_BUDGET - used;
      budgetSummary.innerHTML = `
        ğŸ’° ç·äºˆç®—: ${TOTAL_BUDGET} å††<br>
        ğŸ§¾ ä½¿ç”¨ä¸­é‡‘é¡: ${used} å††<br>
        ğŸ’¸ æ®‹ã‚Šäºˆç®—: ${remaining} å††
      `;
    }

    window.submitActual = (id) => {
      const target = requests.find(r => r.id === id);
      const input = document.getElementById(`actual-${id}`);
      const actual = parseInt(input.value);
      if (actual > target.planned) {
        alert("äºˆå®šé‡‘é¡ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚ç™»éŒ²ã§ãã¾ã›ã‚“ã€‚");
        return;
      }
      target.actual = actual;
      target.complete = true;
      render();
    };
  </script>
</body>
</html>
